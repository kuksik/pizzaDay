{"version":3,"sources":["meteor://ðŸ’»app/server/method.js"],"names":[],"mappings":"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","file":"/server/method.js","sourcesContent":["Meteor.startup( function() {\n\tprocess.env.MAIL_URL = 'smtp://kuks:b12ckh01e@smtp.sendgrid.net:587';\n});\nMeteor.methods({\n\n\t'chekcNewUserInfo': function(data) {\n\t\tvar res = { 'valid': true };\n\t\t\n\t\tif ( !!Accounts.findUserByEmail(data.email) ) {\n\t\t\tres.email = !!Accounts.findUserByEmail(data.email);\n\t\t\tres.valid = false;\n\t\t};\n\t\tif ( !!Users.findOne({'profile.name': data.name}) ) {\n\t\t\tres.name = !!Users.findOne({'profile.name': data.name});\n\t\t\tres.valid = false;\n\t\t}\n\n\t\treturn res;\n\t},\n\n\t'removeNotifications': function(groupId) {\n\t\tNotifications.remove({'groupId': groupId})\n\t},\n\n\t'removeUserNotification': function(userId) {\n\t\tNotifications.remove({'userId': userId})\n\t},\n\n\t'removeGroup': function(groupId) {\n\t\tGroups.remove({'_id': groupId});\n\t},\n\n\t'addEvent' : function(groupId, userId, participation) {\n\t\tif (!Groups.findOne({_id: groupId}).pizzaDay) {\n  \t\t\tGroups.update( \n    \t\t\t{'_id': groupId},\n    \t\t\t{ $set: { 'pizzaDay': {\n\t\t\t\t\tcreated:true,\n\t\t\t\t\tdate: (new Date()).toDateString(), \n\t\t\t\t\tcreator: Meteor.userId(),\n\t\t\t\t\tcreatorName: Meteor.user().profile.name,     \n\t\t\t\t\tstatus: \"ordering\"\n              \t} } }  \n\t\t\t);\n\t\t};          \n\t\t\n\t\tGroups.update( \n  \t\t\t{ '_id': groupId, 'members.id': userId },\n  \t\t\t{ $set: { \n      \t\t\t'members.$.event': {\n        \t\t\t'participation': participation,\n        \t\t\t'usedCoupons': []\n      \t\t\t}\n       \t\t} }\n\t\t);\n\t},\n\n\t'addOrder': function(groupId, userId, order) {\n\t\tGroups.update(\n\t\t\t{ '_id': groupId, 'members.id':userId },\n\t\t\t{ $set: { 'members.$.event.order': order} } \n\t\t);\n\t},\n\n\t'sendEmail': function(userId, html) {\n\t    var user = Users.findOne(\n\t    \t\t\t\t{ '_id': userId },\n\t    \t\t\t\t{ 'fields': { 'services.google.email': 1, 'emails.address': 1 } }\n\t    \t\t\t);\n\n\t    if (user.services.google) {  \n\t     \tvar email = user.services.google.email;\n\t    }\n    \telse {\n      \t\tvar email = user.emails[0].address;\n    \t};\n\n    \tEmail.send({\n      \t\tto: email,\n      \t\tfrom: \"pizzaday-admin@gmail.com\",\n   \t   \t    subject: \"Your order confirmed!\",\n   \t   \t\thtml: html\n    \t});  \n\t}\n});"]}